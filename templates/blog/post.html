{% extends "blog/base.html" %}
{% block css_links %}
{% load static %}
<link href="{% static 'blog/css/blog-post.css' %}" rel="stylesheet">
<link rel="stylesheet" href="{% static "blog/css/blog-main.css" %}">
<link rel="stylesheet" href="{% static "blog/css/blog-post-custom.css" %}">
{% endblock css_links %}


{% block content %}
<!-- Blog Post -->

<!-- Title -->
    <h1>{{post.title}}</h1>

<!-- Author -->
    <p class="lead">
        by 
        <a href="{% url "user_profile" post.user.user.username %}"> 
            {{post.user.user.username}}
        </a>
    </p>

    <hr>

    <!-- Date/Time -->
    <p><span class="glyphicon glyphicon-time"></span> Posted on {{post.publish_date}}</p>
    {% if post.last_modified %}
        <p><i class="bi bi-pencil-fill"></i> Last modified: {{ post.last_modified }}</p>
    {% endif %}

    <hr>

    <!-- Preview Image -->
    {% if post.image %}
        <img class="img-responsive" src="{{ post.image.url }}" alt="{{ post.title }}">
    {% endif %}
    <hr>

    <!-- Post Content -->
    {% if post.first_post_image %}
    <img class="img-responsive" src="{{ post.first_post_image.url }}" alt="{{ post.title }}">
    {% endif %}
    <p class="lead" style='margin-top: 1em'>{{post.content}}</p>
    {% if post.second_post_image %}
    <img class="img-responsive" src="{{ post.second_post_image.url }}" alt="{{ post.title }}">
    {% endif %}
    <hr>

    {% if user.is_authenticated %}
    <div class="category">
        <form action="{% url "like_post" post.pk %}" method="POST" style='display:flex; align-items: self-end; justify-content: center; gap:.2em'>
            {% csrf_token %}
            <button type="submit" style="background: none; border: none" name="post_id" value="{{ post.id }}">
            {% if user in post.likes.all %}
                <i class="bi bi-suit-heart-fill" style="font-size: 40px; color: #b22222"></i>
            {% else %}
                <i class="bi bi-suit-heart" style="font-size: 40px; color: gray"></i>
            {% endif %}
            </button>
            <p style='font-size: 27px'>{{post_likes}}</p>
        </form>
    </div>

    {% else %}
    <div class="category">
        <div style='display:flex; align-items: self-end; justify-content: center; gap:.2em'>
            <button style="background: none; border: none" name="post_id" value="{{ post.id }}">
                <a href="{% url "register" %}">
                    <i class="bi bi-suit-heart" style="font-size: 40px; color: gray"></i>
                </a>
            </button>
            <p style='font-size: 27px'>{{post.likes.count}}</p>
        </div>
    </div>
    {% endif %}

    <div class="tags">
        <p>Tags</p>
        <div class="tags-content">
            {% for tag in post.tags.all %}
            <p><a href="{% url 'tag' tag.name %}">{{tag.name}}</a></p>
            {% endfor %}
        </div>  
    </div>
    <div class="category">
        <p>category</p>
        <div class="category-content">
            <p><a href="{% url 'category' post.category.name %}">{{post.category.name}}</a></p>
        </div>  
    </div>



    <div class="edit-delete" style='
    display: flex;
    gap: 1em;
    margin: 1em 0;'>
        {% if user == post.user.user %}
            <button class='btn btn-primary'><a href="{% url "edit_post" id=post.pk %}" style='color:white'><i class="bi bi-pencil-square"></i> Edit Post</a></button>
            <button class='btn btn-danger'><a href="{% url 'delete_post' id=post.id %}" style='color:white'><i class="bi bi-trash-fill"></i> Delete Post</a></button>
        {% endif %}
    </div>

    <hr>

<!-- Blog Comments -->

    <!-- Comments Form -->
    {% if user.is_authenticated %}
        <div class="well">
            <h4>Leave a Comment:</h4>
            <form method='POST' class='comment-form'>
                {% csrf_token %}
                <div>

                    {{ form.content }}  <!-- This will only render the widget, not the label -->
                </div>
                <div class="btn">
                    <button type="submit" class='btn btn-default'>Send</button>
                </div>
            </form>
        </div>

    {% else %}

        <h4 class='btn btn-danger' style='cursor: default; pointer-events: none;'>To add comments log in or register first</h4>


    {% endif %}

    <hr>

    <!-- Posted Comments -->

    <!-- Comment -->
    {% for comment in comments %}
        <div class="media" id="comment-{{ comment.pk }}" style='display: flex'>
            <a class="pull-left" href="{% url "user_profile" comment.user.username %}">
                {% if comment.user.profile.avatar %}
                <img style='max-width: 35px' class="media-object" src="{{comment.user.profile.avatar.url}}" alt="avatar">
                {% else %}
                <img style='max-width: 35px' class="media-object" src="https://i.sstatic.net/34AD2.jpg" alt="avatar">
                {% endif %}
            </a>
            <div class="media-body">
                <h4 class="media-heading">{{comment.user.username}}
                    <small>{{comment.publish_date}}</small>
                </h4>
                {{comment.content}}
            </div>
            {% if user == comment.user or user == comment.post.user.user %}
            <form action="{% url 'delete_comment' comment_id=comment.pk %}" method="POST" style="margin-left: auto;">
                {% csrf_token %}
                <button type="submit" class='btn btn-danger'>
                    <i class="bi bi-trash-fill"></i> Delete
                </button>
            </form>
        {% endif %}
        </div>
    {% endfor %}


{% endblock content %}